<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" data-semver="3.3.5" data-require="bootstrap@*" />
  <link href="style.css" rel="stylesheet" />
  <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js"></script>
  <script>
    if (!window.jQuery) {
      document.write('<script src="/path/to/your/jquery"><\/script>');
    }
  </script>
  <script>
  //getting pricing and static data from xml files
    var staticData;
    var pricingData;
    var activeISIN;
    var activeManager;
    
    function changeActiveManager(manager){
      activeManager = manager;
      fundsPrices();
    }
    
    function changeActiveISIN(isin){
    activeISIN = isin;
    fundsPrices();
    }
    
    $.get("Security_staticdata.xml", function(data) {
      staticData = data;
    });
    $.get("Security_pricingdata.xml", function(data) {
      pricingData = data;
    });

//this function is called when 'Funds prices' is clicked on menu panel
    function fundsPrices(activeManager) {
      loadTable(activeManager);
      loadShowAll_btn();
    }

//function resposible for adding 'show all' button
    function loadShowAll_btn() {
      var showAll = "<a onClick='changeActiveManager(&quot;All&quot;)' href='#'>Show All</a>";
      document.getElementById('main-top').innerHTML = showAll;
    }

//function resposible for loading the table accepting manager name or 'all;'
    function loadTable(managerOpt) {
      //aquire fund pricing tree
      var funds = pricingData.getElementsByTagName("fund");
      //aquire fund static data tree
      var manager = staticData.getElementsByTagName("manager");
      //check number of managers in xml
      var mnanagerNum = manager.length;
      //draw the header
      var table = "<div class='row'><table id='t01' class='col-sm-12'><tr><th class='col-sm-2'>ISIN code</th><th class='col-sm-5'>Security name</th><th class='col-sm-1'>Currency</th><th class='col-sm-2'>NAV price</th><th class='col-sm-2'>Valuation date</th></tr>";
      var j, i, k, fundNum;
      
      //populating table with data for i manager
      function populateTable(i) {
        //get number of funds for i manager
        fundNum = manager[i].children.length;
        //for each fund draw the table row
        for (j = 0; j < fundNum; j++) {
          for (k = 0; k < funds.length; k++) {
            if (funds[k].getAttribute("code") === manager[i].children.item(j).getAttribute("code")) {
              var fund = new Object();
              fund.isin = manager[i].children.item(j).getAttribute("code");
              fund.fundName = manager[i].children.item(j).getElementsByTagName("fname")[0].childNodes[0].nodeValue;
              fund.currency = funds[k].getAttribute("currency");
              fund.nav = funds[k].children.item(0).getElementsByTagName("NAV")[0].childNodes[0].nodeValue;
              fund.date = funds[k].children.item(0).getAttribute("date");
              table = table + "<tr><td>" + fund.isin + "</td>" +
                                  "<td><a onclick='changeActiveISIN(&quot;" + fund.isin + "&quot;)' href='#'>" + fund.fundName + "</a></td>" + 
                                  "<td>" + fund.currency + "</td>" + 
                                  "<td>" + fund.nav + "</td>" + 
                                  "<td>" + fund.date +"</td></tr>";
                fundInfo (fund.isin);
            }
          }
        }
      }
      
      function fundInfo (isin) {
        if (isin == activeISIN) {
          table = table + "<td colspan='5'><h3>Display historical details here</h3></td>";
        }
      }
      
      //draw the list of managers
      var managerName;
      //for each manager in tree
      for (i = 0; i < mnanagerNum; i++) {
        managerName = manager[i].getAttribute("name");
        //display its name as a link
        table = table + "<tr><td colspan='5'><a onclick='changeActiveManager(&quot;" + managerName + "&quot;)' href='#'>" + managerName +
          "</a></td></tr>";
        //if the mnager name was also passed in loadTable() parameter display prices as well using populateTable()
        if (activeManager === manager[i].getAttribute("name")) {
          populateTable(i);
        //if 'all parameter has been passed by 'show all' bytton draw all prices
        } else if (activeManager === "All") {
          populateTable(i);
        }
      }
      table = table + "</table></div>";
      //finally pass the created html to 'main-mid' div
      document.getElementById("main-mid").innerHTML = table;
    }

//old function displaying dropdown preserved for the moment as other dropdown will be needed in the future [not used at the moment]
    function loadDropdown() {
      var stuff = "<select onchange='loadTable(this.value)' name='managers'><option value='All'>All</option>";
      var i;
      var manager = staticData.getElementsByTagName("manager");
      var mnanagerNum = manager.length;
      for (i = 0; i < mnanagerNum; i++) {
        var value = manager[i].getAttribute("name");
        stuff = stuff + "<option value='" + value + "'>" + value + "</option>";
      }
      stuff = stuff + "</select>";
      document.getElementById("dropdown").innerHTML = stuff;
    }
  </script>
</head>

<body>
  <header class="container-fluid">
    <H1>FUND MANAGEMENT SYSTE</H1>
  </header>
  <div class="container-fluid">
    <div class="row">
      <aside class="col-sm-2">
        <h4 class="menu-title">
            MENU
          </h4>
        <div class="menu-list">
          <a href="#">
            <h4>Add manager</h4>
          </a>
          <a href="#">
            <h4>Add fund</h4>
          </a>
          <a href="#">
            <h4>Update prices</h4>
          </a>
          <a onclick='fundsPrices()' href="#">
            <h4>Funds Prices</h4>
          </a>
        </div>
      </aside>

      <section class="col-sm-10">
        <div id="main-top"></div>
        <div id="main-mid"></div>
        <div id="main-bot"></div>
      </section>

    </div>
  </div>
  <footer class="container-fluid">
    <H1>FOOTER</H1>
  </footer>
</body>

</html>